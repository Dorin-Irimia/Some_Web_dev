<!DOCTYPE html>
<html>
<head>
  <title>ESP32 Value</title>
</head>
<body>
  <h1>Valoarea de la ESP32:</h1>
  <div id="valoare">Așteptând...</div>

  <script>
    const webSocket = new WebSocket('wss://esp32servertest.glitch.me/'); // Adresa ta Glitch

    webSocket.onmessage = event => {
      // Încearcă să parsezi datele ca JSON. Dacă nu reușește, afișează-le ca text simplu.
      try {
        const data = JSON.parse(event.data);
        document.getElementById('valoare').innerText = data.value; // Accesează proprietatea `value` din JSON
      } catch (error) {
        console.warn('Date primite nu sunt în format JSON:', event.data);
        document.getElementById('valoare').innerText = event.data;
      }
    };

    webSocket.onopen = () => {
      console.log('Conectat la serverul WebSocket');
    };

    webSocket.onerror = error => {
      console.error('Eroare la conexiunea WebSocket:', error);
    };

    webSocket.onclose = () => {
      console.log('Conexiunea WebSocket închisă');
    };

    // Funcție pentru a trimite un mesaj prin WebSocket (opțional)
    function trimiteMesaj(mesaj) {
      if (webSocket.readyState === WebSocket.OPEN) {
        webSocket.send(mesaj);
      } else {
        console.error('Conexiunea WebSocket nu este deschisă.');
      }
    }

    // Exemplu de trimitere a unui mesaj la fiecare 5 secunde (opțional)
    // setInterval(() => {
    //   trimiteMesaj('Cerere date');
    // }, 5000);
  </script>
</body>
</html>